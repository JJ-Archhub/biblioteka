<!DOCTYPE html>
<html lang="sq">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ðŸ“š Bibloteka Lasgush Poradeci</title>
  
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Nunito:wght@300;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
  <style>
    :root {
      --bg: #F5F1E3;
      --text: #3E2723;
      --card-bg: rgba(255, 255, 255, 0.95);
      --accent: #6D4C41;
      --accent-hover: #5D4037;
    }
    body.dark-mode {
      --bg: #121212;
      --text: #E0E0E0;
      --card-bg: #1E1E1E;
      --accent: #8D6E63;
      --accent-hover: #A1887F;
    }
    body {
      margin: 0;
      padding: 0;
      font-family: 'Nunito', sans-serif;
      background-color: var(--bg);
      color: var(--text);
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 20px;
      transition: background-color 0.3s, color 0.3s;
    }
    .container {
      max-width: 800px;
      width: 100%;
      text-align: center;
      padding: 60px 40px;
      background: var(--card-bg);
      border-radius: 12px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
      position: relative;
    }
    h1 {
      font-family: 'Playfair Display', serif;
      font-size: 48px;
      margin-bottom: 10px;
      color: var(--text);
      line-height: 1.2;
    }
    h2 {
      font-family: 'Playfair Display', serif;
      font-size: 24px;
      margin-bottom: 30px;
      color: var(--text);
      opacity: 0.9;
      font-weight: 400;
    }
    p.quote {
      font-size: 20px;
      color: var(--text);
      opacity: 0.8;
      margin-bottom: 40px;
      font-style: italic;
      border-top: 2px solid var(--accent);
      border-bottom: 2px solid var(--accent);
      padding: 20px 0;
      display: inline-block;
      width: 80%;
    }
    .btn-group {
      display: flex;
      flex-direction: column;
      gap: 15px;
      align-items: center;
      justify-content: center;
    }
    .cta-button {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      padding: 16px 32px;
      font-size: 18px;
      color: #fff;
      background-color: var(--accent);
      border: none;
      border-radius: 8px;
      text-decoration: none;
      transition: all 0.3s ease;
      width: 100%;
      max-width: 300px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    .cta-button:hover {
      background-color: var(--accent-hover);
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.15);
    }
    .cta-button.secondary {
      background-color: #8D6E63;
    }
    .cta-button.secondary:hover {
      background-color: #6D4C41;
    }
    footer {
      margin-top: 50px;
      font-size: 14px;
      color: var(--text);
      opacity: 0.7;
    }
    
    .dark-mode-toggle {
      position: absolute;
      top: 20px;
      right: 20px;
      background: none;
      border: 1px solid var(--text);
      color: var(--text);
      padding: 8px 12px;
      border-radius: 20px;
      cursor: pointer;
      font-size: 18px;
      transition: all 0.3s;
    }
    .dark-mode-toggle:hover {
      background: var(--accent);
      color: #fff;
      border-color: var(--accent);
    }

    @media (max-width: 480px) {
      h1 { font-size: 36px; }
      p.quote { font-size: 18px; width: 100%; }
      .cta-button { font-size: 16px; width: 100%; }
    }
  </style>
<link rel="stylesheet" href="/index.css">
</head>
<body>
  <div class="container">
    <button class="dark-mode-toggle" onclick="toggleDarkMode()" title="Ndrysho Sfondin">
      <i class="fas fa-moon"></i>
    </button>

    <h1>Biblioteka<br>"Lasgush Poradeci"</h1>
    <h2>MirÃ« se vini nÃ« botÃ«n e dijes!</h2>
    
    <p class="quote">"Libri Ã«shtÃ« miku mÃ« i mirÃ« pÃ«r njeriun."</p>
    
    <div class="btn-group">
      
      <a href="login.html" class="cta-button">
        <i class="fas fa-sign-in-alt"></i> Hyr / Regjistrohu
      </a>
      
      
      <a href="#vizitor" class="cta-button secondary" onclick="openGuest(event)">
        <i class="fas fa-user-secret"></i> Eksploro si Vizitor
      </a>
    </div>

    <footer>
      &copy; 2026 Shkolla "Lasgush Poradeci"<br>
      NÃ« ShÃ«rbim tÃ« komunitetit dhe arsimit ðŸ“š
    </footer>
  </div>

  <script>
    
    if (localStorage.getItem('theme') === 'dark') {
      document.body.classList.add('dark-mode');
      document.querySelector('.dark-mode-toggle i').classList.replace('fa-moon', 'fa-sun');
    }

    function toggleDarkMode() {
      document.body.classList.toggle('dark-mode');
      const isDark = document.body.classList.contains('dark-mode');
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
      
      const icon = document.querySelector('.dark-mode-toggle i');
      if (isDark) {
        icon.classList.replace('fa-moon', 'fa-sun');
      } else {
        icon.classList.replace('fa-sun', 'fa-moon');
      }
    }
  </script>
<script type="module" src="/index.tsx"></script>


  
  <style id="guest-embed-style">
    
    .guest-iframe-wrap{position:fixed; inset:0; background:var(--bg); z-index:9999; display:flex; flex-direction:column;}
    .guest-iframe{flex:1; width:100%; border:0; display:block;}
    .guest-back{position:static; z-index:10000; background:var(--card-bg); border:1px solid var(--text); color:var(--text); padding:8px 12px; border-radius:20px; cursor:pointer; font-size:16px;}
    .guest-back:hover{background:var(--accent); color:#fff; border-color:var(--accent);}
    .guest-topbar{padding:12px 16px; display:flex; align-items:center;}
  </style>
  <script>
    (function(){
      const DASHBOARD_B64 = "PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9InNxIj4KPGhlYWQ+CiAgPG1ldGEgY2hhcnNldD0iVVRGLTgiIC8+CiAgPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCwgaW5pdGlhbC1zY2FsZT0xLjAiLz4KICA8dGl0bGU+S2F0YWxvZ3UgLSBCaWJsaW90ZWthIExhc2d1c2ggUG9yYWRlY2k8L3RpdGxlPgogIDxsaW5rIGhyZWY9Imh0dHBzOi8vZm9udHMuZ29vZ2xlYXBpcy5jb20vY3NzMj9mYW1pbHk9UGxheWZhaXIrRGlzcGxheTp3Z2h0QDQwMDs3MDAmZmFtaWx5PU51bml0bzp3Z2h0QDMwMDs2MDAmZGlzcGxheT1zd2FwIiByZWw9InN0eWxlc2hlZXQiPgogIDxsaW5rIHJlbD0ic3R5bGVzaGVldCIgaHJlZj0iaHR0cHM6Ly9jZG5qcy5jbG91ZGZsYXJlLmNvbS9hamF4L2xpYnMvZm9udC1hd2Vzb21lLzYuMC4wL2Nzcy9hbGwubWluLmNzcyIgLz4KICA8c3R5bGU+CiAgICA6cm9vdCB7CiAgICAgIC0tYmc6ICNGNUYxRTM7CiAgICAgIC0tdGV4dDogIzNFMjcyMzsKICAgICAgLS1jYXJkLWJnOiByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuOTUpOwogICAgICAtLWFjY2VudDogIzZENEM0MTsKICAgICAgLS1hY2NlbnQtaG92ZXI6ICM1RDQwMzc7CiAgICB9CiAgICBib2R5LmRhcmsgewogICAgICAtLWJnOiAjMTIxMjEyOwogICAgICAtLXRleHQ6ICNFMEUwRTA7CiAgICAgIC0tY2FyZC1iZzogIzFFMUUxRTsKICAgICAgLS1hY2NlbnQ6ICM4RDZFNjM7CiAgICAgIC0tYWNjZW50LWhvdmVyOiAjQTE4ODdGOwogICAgfQogICAgYm9keSB7CiAgICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsKICAgICAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tYmcpOwogICAgICBjb2xvcjogdmFyKC0tdGV4dCk7CiAgICAgIGZvbnQtZmFtaWx5OiAnTnVuaXRvJywgc2Fucy1zZXJpZjsKICAgICAgbWFyZ2luOiAwOwogICAgICBwYWRkaW5nOiAyMHB4OwogICAgICB0cmFuc2l0aW9uOiBiYWNrZ3JvdW5kIDAuM3MsIGNvbG9yIDAuM3M7CiAgICAgIG1pbi1oZWlnaHQ6IDEwMHZoOwogICAgfQogICAgLmNvbnRhaW5lciB7IG1heC13aWR0aDogMTIwMHB4OyBtYXJnaW46IDAgYXV0bzsgfQoKICAgIGhlYWRlciB7IHRleHQtYWxpZ246IGNlbnRlcjsgbWFyZ2luLWJvdHRvbTogNDBweDsgYW5pbWF0aW9uOiBmYWRlSW4gMXMgZWFzZS1vdXQ7IH0KICAgIGgxIHsgZm9udC1mYW1pbHk6ICdQbGF5ZmFpciBEaXNwbGF5Jywgc2VyaWY7IGZvbnQtc2l6ZTogMzZweDsgbWFyZ2luLWJvdHRvbTogMTBweDsgfQoKICAgIC5zdGF0cy1iYXIgewogICAgICBkaXNwbGF5OiBpbmxpbmUtZmxleDsgZ2FwOiAyMHB4OyBiYWNrZ3JvdW5kOiByZ2JhKDAsMCwwLDAuMDUpOyBwYWRkaW5nOiA4cHggMjBweDsgYm9yZGVyLXJhZGl1czogMjBweDsgbWFyZ2luOiAxNXB4IDA7IGZvbnQtc2l6ZTogMC45cmVtOwogICAgfQogICAgYm9keS5kYXJrIC5zdGF0cy1iYXIgeyBiYWNrZ3JvdW5kOiByZ2JhKDI1NSwyNTUsMjU1LDAuMSk7IH0KCiAgICAuY29udHJvbHMgewogICAgICBkaXNwbGF5OiBmbGV4OyBmbGV4LXdyYXA6IHdyYXA7IGdhcDogMTVweDsganVzdGlmeS1jb250ZW50OiBjZW50ZXI7IG1hcmdpbi1ib3R0b206IDMwcHg7CiAgICAgIGJhY2tncm91bmQ6IHZhcigtLWNhcmQtYmcpOyBwYWRkaW5nOiAyMHB4OyBib3JkZXItcmFkaXVzOiAxMnB4OyBib3gtc2hhZG93OiAwIDRweCA2cHggcmdiYSgwLDAsMCwwLjA1KTsKICAgIH0KICAgIGlucHV0LCBzZWxlY3QgeyBwYWRkaW5nOiAxMnB4OyBmb250LXNpemU6IDE2cHg7IGJvcmRlcjogMXB4IHNvbGlkICNjY2M7IGJvcmRlci1yYWRpdXM6IDhweDsgfQogICAgaW5wdXQgeyBmbGV4OiAxOyBtaW4td2lkdGg6IDIwMHB4OyB9CgogICAgLyogTW9kZXJuIEJvb2sgQ2FyZCBEZXNpZ24gKi8KICAgIC5ib29rLWxpc3QgeyBkaXNwbGF5OiBncmlkOyBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IHJlcGVhdChhdXRvLWZpbGwsIG1pbm1heCgyNDBweCwgMWZyKSk7IGdhcDogMzBweDsgfQoKICAgIC5ib29rIHsKICAgICAgYmFja2dyb3VuZDogdHJhbnNwYXJlbnQ7IHBlcnNwZWN0aXZlOiAxMDAwcHg7IGN1cnNvcjogcG9pbnRlcjsKICAgIH0KICAgIC5ib29rLWlubmVyIHsKICAgICAgYmFja2dyb3VuZDogdmFyKC0tY2FyZC1iZyk7IGJvcmRlci1yYWRpdXM6IDEycHg7IGJveC1zaGFkb3c6IDAgNHB4IDE1cHggcmdiYSgwLDAsMCwwLjEpOwogICAgICB0cmFuc2l0aW9uOiB0cmFuc2Zvcm0gMC4zcywgYm94LXNoYWRvdyAwLjNzOyBvdmVyZmxvdzogaGlkZGVuOyBoZWlnaHQ6IDEwMCU7IGRpc3BsYXk6IGZsZXg7IGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgICB9CiAgICAuYm9vazpob3ZlciAuYm9vay1pbm5lciB7IHRyYW5zZm9ybTogdHJhbnNsYXRlWSgtOHB4KTsgYm94LXNoYWRvdzogMCAxMnB4IDI1cHggcmdiYSgwLDAsMCwwLjE1KTsgfQoKICAgIC8qIENTUyBHZW5lcmF0ZWQgQ292ZXIgKi8KICAgIC5ib29rLWNvdmVyIHsKICAgICAgaGVpZ2h0OiAxNjBweDsgZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IGNlbnRlcjsganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgxMzVkZWcsIHZhcigtLWFjY2VudCkgMCUsICMzZTI3MjMgMTAwJSk7CiAgICAgIGNvbG9yOiByZ2JhKDI1NSwyNTUsMjU1LDAuOSk7IGZvbnQtZmFtaWx5OiAnUGxheWZhaXIgRGlzcGxheScsIHNlcmlmOwogICAgICBmb250LXNpemU6IDNyZW07IHBvc2l0aW9uOiByZWxhdGl2ZTsKICAgIH0KICAgIC5ib29rLWNvdmVyOjphZnRlciB7CiAgICAgIGNvbnRlbnQ6ICcnOyBwb3NpdGlvbjogYWJzb2x1dGU7IGxlZnQ6IDEwcHg7IHRvcDogMDsgYm90dG9tOiAwOyB3aWR0aDogMnB4OwogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsMCwwLDAuMik7IGJveC1zaGFkb3c6IDFweCAwIDFweCByZ2JhKDI1NSwyNTUsMjU1LDAuMSk7CiAgICB9CgogICAgLmJvb2stZGV0YWlscyB7IHBhZGRpbmc6IDE1cHg7IGZsZXgtZ3JvdzogMTsgZGlzcGxheTogZmxleDsgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsgfQogICAgLmJvb2sgaDMgeyBmb250LWZhbWlseTogJ1BsYXlmYWlyIERpc3BsYXknLCBzZXJpZjsgZm9udC1zaXplOiAxOHB4OyBtYXJnaW46IDAgMCA1cHggMDsgY29sb3I6IHZhcigtLXRleHQpOyBsaW5lLWhlaWdodDogMS4zOyB9CiAgICAuYm9vay1tZXRhIHsgZm9udC1zaXplOiAxM3B4OyBjb2xvcjogdmFyKC0tdGV4dCk7IG9wYWNpdHk6IDAuODsgbWFyZ2luLWJvdHRvbTogMTBweDsgfQoKICAgIC5zdGF0dXMtYmFkZ2UgewogICAgICBmb250LXNpemU6IDExcHg7IHBhZGRpbmc6IDRweCA4cHg7IGJvcmRlci1yYWRpdXM6IDRweDsgZm9udC13ZWlnaHQ6IGJvbGQ7IGFsaWduLXNlbGY6IGZsZXgtc3RhcnQ7IG1hcmdpbi10b3A6IGF1dG87CiAgICB9CiAgICAuYXZhaWxhYmxlIHsgYmFja2dyb3VuZC1jb2xvcjogI2U4ZjVlOTsgY29sb3I6ICMyZTdkMzI7IH0KICAgIC51bmF2YWlsYWJsZSB7IGJhY2tncm91bmQtY29sb3I6ICNmZmViZWU7IGNvbG9yOiAjYzYyODI4OyB9CgogICAgLyogTW9kYWwgU3R5bGVzICovCiAgICAubW9kYWwtb3ZlcmxheSB7CiAgICAgIGRpc3BsYXk6IG5vbmU7IHBvc2l0aW9uOiBmaXhlZDsgdG9wOiAwOyBsZWZ0OiAwOyB3aWR0aDogMTAwJTsgaGVpZ2h0OiAxMDAlOwogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsMCwwLDAuNik7IHotaW5kZXg6IDIwMDA7IGp1c3RpZnktY29udGVudDogY2VudGVyOyBhbGlnbi1pdGVtczogY2VudGVyOyBiYWNrZHJvcC1maWx0ZXI6IGJsdXIoM3B4KTsKICAgIH0KICAgIC5tb2RhbC1jb250ZW50IHsKICAgICAgYmFja2dyb3VuZDogdmFyKC0tY2FyZC1iZyk7IHdpZHRoOiA5MCU7IG1heC13aWR0aDogNjAwcHg7IGJvcmRlci1yYWRpdXM6IDEycHg7CiAgICAgIGJveC1zaGFkb3c6IDAgMjBweCA1MHB4IHJnYmEoMCwwLDAsMC4zKTsgb3ZlcmZsb3c6IGhpZGRlbjsgZGlzcGxheTogZmxleDsgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICAgICAgYW5pbWF0aW9uOiB6b29tSW4gMC4zcyBlYXNlOyBwb3NpdGlvbjogcmVsYXRpdmU7CiAgICB9CiAgICAubW9kYWwtaGVhZGVyIHsKICAgICAgcGFkZGluZzogMjBweDsgYmFja2dyb3VuZDogdmFyKC0tYWNjZW50KTsgY29sb3I6IHdoaXRlOyBkaXNwbGF5OiBmbGV4OyBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47IGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICB9CiAgICAubW9kYWwtYm9keSB7IHBhZGRpbmc6IDMwcHg7IGNvbG9yOiB2YXIoLS10ZXh0KTsgbGluZS1oZWlnaHQ6IDEuNjsgfQogICAgLm1vZGFsLWZvb3RlciB7IHBhZGRpbmc6IDIwcHg7IGJvcmRlci10b3A6IDFweCBzb2xpZCByZ2JhKDAsMCwwLDAuMSk7IHRleHQtYWxpZ246IHJpZ2h0OyB9CiAgICAuY2xvc2UtbW9kYWwgeyBjdXJzb3I6IHBvaW50ZXI7IGZvbnQtc2l6ZTogMS41cmVtOyBjb2xvcjogd2hpdGU7IH0KICAgIC5sb2dpbi1idG4tbW9kYWwgewogICAgICBiYWNrZ3JvdW5kOiB2YXIoLS1hY2NlbnQpOyBjb2xvcjogd2hpdGU7IGJvcmRlcjogbm9uZTsgcGFkZGluZzogMTBweCAyMHB4OyBib3JkZXItcmFkaXVzOiA2cHg7CiAgICAgIGZvbnQtc2l6ZTogMXJlbTsgY3Vyc29yOiBwb2ludGVyOyB0ZXh0LWRlY29yYXRpb246IG5vbmU7IGRpc3BsYXk6IGlubGluZS1ibG9jazsKICAgIH0KICAgIC5sb2dpbi1idG4tbW9kYWw6aG92ZXIgeyBiYWNrZ3JvdW5kOiB2YXIoLS1hY2NlbnQtaG92ZXIpOyB9CgogICAgI2RhcmtUb2dnbGUgeyBwb3NpdGlvbjogYWJzb2x1dGU7IHRvcDogMjBweDsgcmlnaHQ6IDIwcHg7IGJhY2tncm91bmQ6IHZhcigtLWNhcmQtYmcpOyBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS10ZXh0KTsgY29sb3I6IHZhcigtLXRleHQpOyBwYWRkaW5nOiA4cHggMTJweDsgYm9yZGVyLXJhZGl1czogMjBweDsgY3Vyc29yOiBwb2ludGVyOyB6LWluZGV4OiAxMDA7IGZvbnQtc2l6ZTogMjBweDsgfQogICAgI3Njcm9sbFRvcEJ0biB7IHBvc2l0aW9uOiBmaXhlZDsgYm90dG9tOiAzMHB4OyByaWdodDogMzBweDsgcGFkZGluZzogMTJweCAxNnB4OyBiYWNrZ3JvdW5kOiB2YXIoLS1hY2NlbnQpOyBjb2xvcjogd2hpdGU7IGJvcmRlcjogbm9uZTsgYm9yZGVyLXJhZGl1czogNTAlOyBjdXJzb3I6IHBvaW50ZXI7IGRpc3BsYXk6IG5vbmU7IGJveC1zaGFkb3c6IDAgNHB4IDEwcHggcmdiYSgwLDAsMCwwLjIpOyB9CgogICAgLnBhZ2luYXRpb24geyBtYXJnaW46IDMwcHggMDsgZGlzcGxheTogZmxleDsganVzdGlmeS1jb250ZW50OiBjZW50ZXI7IGdhcDogMTBweDsgfQogICAgLnBhZ2UtYnRuIHsgcGFkZGluZzogOHB4IDE2cHg7IGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLWFjY2VudCk7IGJhY2tncm91bmQ6IHZhcigtLWNhcmQtYmcpOyBjb2xvcjogdmFyKC0tdGV4dCk7IGN1cnNvcjogcG9pbnRlcjsgYm9yZGVyLXJhZGl1czogNHB4OyB9CiAgICAucGFnZS1idG4uYWN0aXZlIHsgYmFja2dyb3VuZDogdmFyKC0tYWNjZW50KTsgY29sb3I6IHdoaXRlOyB9CgogICAgQGtleWZyYW1lcyBmYWRlSW4geyBmcm9tIHsgb3BhY2l0eTogMDsgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKC0xMHB4KTsgfSB0byB7IG9wYWNpdHk6IDE7IHRyYW5zZm9ybTogdHJhbnNsYXRlWSgwKTsgfSB9CiAgICBAa2V5ZnJhbWVzIHpvb21JbiB7IGZyb20geyB0cmFuc2Zvcm06IHNjYWxlKDAuOSk7IG9wYWNpdHk6IDA7IH0gdG8geyB0cmFuc2Zvcm06IHNjYWxlKDEpOyBvcGFjaXR5OiAxOyB9IH0KICAKCiAgICAvKiBNb2JpbGUgJiBzbWFsbCBzY3JlZW5zOiBtYWtlIGxheW91dCBtb3JlIGZsZXhpYmxlICovCiAgICBAbWVkaWEgKG1heC13aWR0aDogOTAwcHgpIHsKICAgICAgLmNvbnRyb2xzIHsgZ2FwOiAxMnB4OyB9CiAgICAgIC5ib29rLWxpc3QgeyBnYXA6IDIwcHg7IH0KICAgIH0KCiAgICBAbWVkaWEgKG1heC13aWR0aDogNzAwcHgpIHsKICAgICAgYm9keSB7IHBhZGRpbmc6IDE0cHg7IH0KICAgICAgaDEgeyBmb250LXNpemU6IDI4cHg7IH0KICAgICAgLmNvbnRyb2xzIHsgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsgYWxpZ24taXRlbXM6IHN0cmV0Y2g7IH0KICAgICAgLmNvbnRyb2xzIGlucHV0LCAuY29udHJvbHMgc2VsZWN0IHsgd2lkdGg6IDEwMCU7IG1pbi13aWR0aDogMDsgYm94LXNpemluZzogYm9yZGVyLWJveDsgfQogICAgICAuc3RhdHMtYmFyIHsgZ2FwOiAxMnB4OyBmbGV4LXdyYXA6IHdyYXA7IGp1c3RpZnktY29udGVudDogY2VudGVyOyB9CiAgICAgIC5ib29rLWNvdmVyIHsgaGVpZ2h0OiAxNDBweDsgZm9udC1zaXplOiAyLjVyZW07IH0KICAgICAgLm1vZGFsLWNvbnRlbnQgeyB3aWR0aDogOTUlOyBtYXgtaGVpZ2h0OiA5MnZoOyB9CiAgICAgIC5tb2RhbC1ib2R5IHsgcGFkZGluZzogMThweDsgb3ZlcmZsb3c6IGF1dG87IH0KICAgICAgLm1vZGFsLWhlYWRlciB7IHBhZGRpbmc6IDE0cHggMTZweDsgfQogICAgICAubW9kYWwtZm9vdGVyIHsgcGFkZGluZzogMTRweCAxNnB4OyB9CiAgICB9CgogICAgQG1lZGlhIChtYXgtd2lkdGg6IDQyMHB4KSB7CiAgICAgIC5ib29rLWxpc3QgeyBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IHJlcGVhdChhdXRvLWZpbGwsIG1pbm1heCgxOTBweCwgMWZyKSk7IH0KICAgICAgLmJvb2stY292ZXIgeyBoZWlnaHQ6IDEzMHB4OyB9CiAgICB9CgoKCiAgICAvKiBNb2JpbGUtZmlyc3QgdHdlYWtzICovCiAgICBAbWVkaWEgKG1heC13aWR0aDogOTAwcHgpIHsKICAgICAgYm9keSB7IHBhZGRpbmc6IDE0cHg7IH0KICAgICAgLmNvbnRyb2xzIHsgcGFkZGluZzogMTRweDsgfQogICAgfQoKICAgIEBtZWRpYSAobWF4LXdpZHRoOiA3MDBweCkgewogICAgICAuY29udHJvbHMgeyBmbGV4LWRpcmVjdGlvbjogY29sdW1uOyBhbGlnbi1pdGVtczogc3RyZXRjaDsgfQogICAgICBpbnB1dCwgc2VsZWN0IHsgd2lkdGg6IDEwMCU7IGJveC1zaXppbmc6IGJvcmRlci1ib3g7IH0KICAgICAgI2RhcmtUb2dnbGUgeyB0b3A6IDEycHg7IHJpZ2h0OiAxMnB4OyB9CiAgICAgICNzY3JvbGxUb3BCdG4geyBib3R0b206IDE4cHg7IHJpZ2h0OiAxOHB4OyB9CiAgICAgIC5ib29rLWxpc3QgeyBnYXA6IDE4cHg7IH0KICAgICAgLmJvb2stY292ZXIgeyBoZWlnaHQ6IDE0MHB4OyB9CiAgICAgIGgxIHsgZm9udC1zaXplOiAzMHB4OyB9CiAgICB9CgogICAgQG1lZGlhIChtYXgtd2lkdGg6IDQ4MHB4KSB7CiAgICAgIGgxIHsgZm9udC1zaXplOiAyNnB4OyB9CiAgICAgIC5tb2RhbC1jb250ZW50IHsgd2lkdGg6IDk0JTsgbWF4LWhlaWdodDogOTJ2aDsgfQogICAgICAubW9kYWwtYm9keSB7IHBhZGRpbmc6IDE4cHg7IG92ZXJmbG93OiBhdXRvOyB9CiAgICAgIC5tb2RhbC1mb290ZXIgeyBwYWRkaW5nOiAxNHB4OyB9CiAgICAgIC5tb2RhbC1oZWFkZXIgeyBwYWRkaW5nOiAxNHB4OyB9CiAgICAgIC5zdGF0cy1iYXIgeyBnYXA6IDEwcHg7IHBhZGRpbmc6IDhweCAxMnB4OyBmbGV4LXdyYXA6IHdyYXA7IGp1c3RpZnktY29udGVudDogY2VudGVyOyB9CiAgICB9Cgo8L3N0eWxlPgogIDxzY3JpcHQgdHlwZT0iaW1wb3J0bWFwIj4KICB7CiAgICAiaW1wb3J0cyI6IHsKICAgICAgImZpcmViYXNlL2FwcCI6ICJodHRwczovL3d3dy5nc3RhdGljLmNvbS9maXJlYmFzZWpzLzEwLjguMC9maXJlYmFzZS1hcHAuanMiLAogICAgICAiZmlyZWJhc2UvZGF0YWJhc2UiOiAiaHR0cHM6Ly93d3cuZ3N0YXRpYy5jb20vZmlyZWJhc2Vqcy8xMC44LjAvZmlyZWJhc2UtZGF0YWJhc2UuanMiCiAgICB9CiAgfQogIDwvc2NyaXB0Pgo8L2hlYWQ+Cjxib2R5PgogIDxidXR0b24gaWQ9ImRhcmtUb2dnbGUiIG9uY2xpY2s9InRvZ2dsZURhcmtNb2RlKCkiIHRpdGxlPSJOZHJ5c2hvIFNmb25kaW4iPjxpIGNsYXNzPSJmYXMgZmEtbW9vbiI+PC9pPjwvYnV0dG9uPgoKICA8IS0tIERldGFpbHMgTW9kYWwgLS0+CiAgPGRpdiBpZD0iYm9va01vZGFsIiBjbGFzcz0ibW9kYWwtb3ZlcmxheSIgb25jbGljaz0iY2xvc2VNb2RhbChldmVudCkiPgogICAgPGRpdiBjbGFzcz0ibW9kYWwtY29udGVudCI+CiAgICAgIDxkaXYgY2xhc3M9Im1vZGFsLWhlYWRlciI+CiAgICAgICAgPGgyIGlkPSJtb2RhbC10aXRsZSIgc3R5bGU9Im1hcmdpbjowOyBmb250LWZhbWlseTonUGxheWZhaXIgRGlzcGxheScsIHNlcmlmOyI+VGl0dWxsaTwvaDI+CiAgICAgICAgPHNwYW4gY2xhc3M9ImNsb3NlLW1vZGFsIiBvbmNsaWNrPSJkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYm9va01vZGFsJykuc3R5bGUuZGlzcGxheT0nbm9uZSciPiZ0aW1lczs8L3NwYW4+CiAgICAgIDwvZGl2PgogICAgICA8ZGl2IGNsYXNzPSJtb2RhbC1ib2R5Ij4KICAgICAgICA8cD48c3Ryb25nPjxpIGNsYXNzPSJmYXMgZmEtcGVuLW5pYiI+PC9pPiBBdXRvcmk6PC9zdHJvbmc+IDxzcGFuIGlkPSJtb2RhbC1hdXRob3IiPjwvc3Bhbj48L3A+CiAgICAgICAgPHA+PHN0cm9uZz48aSBjbGFzcz0iZmFzIGZhLWxheWVyLWdyb3VwIj48L2k+IFpoYW5yaTo8L3N0cm9uZz4gPHNwYW4gaWQ9Im1vZGFsLWdlbnJlIj48L3NwYW4+PC9wPgogICAgICAgIDxwPjxzdHJvbmc+PGkgY2xhc3M9ImZhcyBmYS1zdGFyIiBzdHlsZT0iY29sb3I6I0ZGRDcwMCI+PC9pPiBWbGVyw6tzaW1pOjwvc3Ryb25nPiA8c3BhbiBpZD0ibW9kYWwtcmF0aW5nIj48L3NwYW4+PC9wPgogICAgICAgIDxwPjxzdHJvbmc+PGkgY2xhc3M9ImZhcyBmYS1oYXNodGFnIj48L2k+IEdqZW5kamE6PC9zdHJvbmc+IDxzcGFuIGlkPSJtb2RhbC1xdHkiPjwvc3Bhbj48L3A+CiAgICAgICAgPGhyIHN0eWxlPSJib3JkZXI6MDsgYm9yZGVyLXRvcDoxcHggc29saWQgcmdiYSgwLDAsMCwwLjEpOyBtYXJnaW46MTVweCAwOyI+CiAgICAgICAgPHAgaWQ9Im1vZGFsLWRlc2MiPjwvcD4KCiAgICAgICAgPCEtLSBMaWJyYSBBdWRpbyAoaW5saW5lIHBsYXliYWNrLCBubyByZWRpcmVjdHMpIC0tPgogICAgICAgIDxkaXYgaWQ9Im1vZGFsLWF1ZGlvIiBzdHlsZT0ibWFyZ2luLXRvcDoxOHB4OyI+PC9kaXY+CgogICAgICAgIDwhLS0gR3Vlc3QgcmF0aW5nICgxLTUgc3RhcnMpIC0tPgogICAgICAgIDxkaXYgaWQ9Imd1ZXN0LXJhdGluZyIgc3R5bGU9Im1hcmdpbi10b3A6MThweDsiPgogICAgICAgICAgPGgzIHN0eWxlPSJtYXJnaW46MCAwIDEwcHggMDsgZm9udC1mYW1pbHk6J1BsYXlmYWlyIERpc3BsYXknLCBzZXJpZjsgZm9udC1zaXplOjE4cHg7Ij5WbGVyw6tzbyBMaWJyaW48L2gzPgogICAgICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTpncmlkOyBnYXA6MTBweDsiPgogICAgICAgICAgICA8c2VsZWN0IGlkPSJyYXRlLXN0YXJzIiBzdHlsZT0icGFkZGluZzoxMHB4OyBib3JkZXItcmFkaXVzOjhweDsgYm9yZGVyOjFweCBzb2xpZCAjY2NjOyI+CiAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iNSI+4piF4piF4piF4piF4piFICg1KTwvb3B0aW9uPgogICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IjQiPuKYheKYheKYheKYheKYhiAoNCk8L29wdGlvbj4KICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSIzIj7imIXimIXimIXimIbimIYgKDMpPC9vcHRpb24+CiAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iMiI+4piF4piF4piG4piG4piGICgyKTwvb3B0aW9uPgogICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IjEiPuKYheKYhuKYhuKYhuKYhiAoMSk8L29wdGlvbj4KICAgICAgICAgICAgPC9zZWxlY3Q+CiAgICAgICAgICAgIDxpbnB1dCBpZD0icmF0ZS1uYW1lIiB0eXBlPSJ0ZXh0IiBwbGFjZWhvbGRlcj0iRW1yaSAob3BzaW9uYWwpIiBzdHlsZT0icGFkZGluZzoxMHB4OyBib3JkZXItcmFkaXVzOjhweDsgYm9yZGVyOjFweCBzb2xpZCAjY2NjOyIgLz4KICAgICAgICAgICAgPHRleHRhcmVhIGlkPSJyYXRlLWNvbW1lbnQiIHJvd3M9IjMiIHBsYWNlaG9sZGVyPSJLb21lbnQgKG9wc2lvbmFsKSIgc3R5bGU9InBhZGRpbmc6MTBweDsgYm9yZGVyLXJhZGl1czo4cHg7IGJvcmRlcjoxcHggc29saWQgI2NjYzsgcmVzaXplOnZlcnRpY2FsOyI+PC90ZXh0YXJlYT4KICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPGRpdiBpZD0icmF0ZS1tc2ciIHN0eWxlPSJtYXJnaW4tdG9wOjEwcHg7IGZvbnQtc2l6ZTowLjk1cmVtOyI+PC9kaXY+CiAgICAgICAgICA8YnV0dG9uIGlkPSJyYXRlLXN1Ym1pdCIgY2xhc3M9ImxvZ2luLWJ0bi1tb2RhbCIgdHlwZT0iYnV0dG9uIiBzdHlsZT0ibWFyZ2luLXRvcDoxMHB4OyI+PGkgY2xhc3M9ImZhcyBmYS1zdGFyIj48L2k+IETDq3JnbyBWbGVyw6tzaW1pbjwvYnV0dG9uPgogICAgICAgIDwvZGl2PgoKICAgICAgICA8IS0tIEJvcnJvdyByZXF1ZXN0IGZvcm0gKGd1ZXN0IG1vZGUpIC0tPgogICAgICAgIDxkaXYgaWQ9Imd1ZXN0LXJlcXVlc3QiIHN0eWxlPSJtYXJnaW4tdG9wOjE4cHg7Ij4KICAgICAgICAgIDxoMyBzdHlsZT0ibWFyZ2luOjAgMCAxMHB4IDA7IGZvbnQtZmFtaWx5OidQbGF5ZmFpciBEaXNwbGF5Jywgc2VyaWY7IGZvbnQtc2l6ZToxOHB4OyI+CiAgICAgICAgICAgIEvDq3JrZXPDqyBww6tyIFTDq3JoZXFqZQogICAgICAgICAgPC9oMz4KICAgICAgICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6Z3JpZDsgZ2FwOjEwcHg7Ij4KICAgICAgICAgICAgPGlucHV0IGlkPSJici1uYW1lIiB0eXBlPSJ0ZXh0IiBwbGFjZWhvbGRlcj0iRW1yaSBkaGUgTWJpZW1yaSIgc3R5bGU9InBhZGRpbmc6MTBweDsgYm9yZGVyLXJhZGl1czo4cHg7IGJvcmRlcjoxcHggc29saWQgI2NjYzsiIC8+CiAgICAgICAgICAgIDxpbnB1dCBpZD0iYnItZW1haWwiIHR5cGU9ImVtYWlsIiBwbGFjZWhvbGRlcj0iRW1haWwiIHN0eWxlPSJwYWRkaW5nOjEwcHg7IGJvcmRlci1yYWRpdXM6OHB4OyBib3JkZXI6MXB4IHNvbGlkICNjY2M7IiAvPgogICAgICAgICAgICA8aW5wdXQgaWQ9ImJyLWNsYXNzIiB0eXBlPSJ0ZXh0IiBwbGFjZWhvbGRlcj0iS2xhc2EiIHN0eWxlPSJwYWRkaW5nOjEwcHg7IGJvcmRlci1yYWRpdXM6OHB4OyBib3JkZXI6MXB4IHNvbGlkICNjY2M7IiAvPgogICAgICAgICAgPC9kaXY+CiAgICAgICAgICA8ZGl2IGlkPSJici1tc2ciIHN0eWxlPSJtYXJnaW4tdG9wOjEwcHg7IGZvbnQtc2l6ZTowLjk1cmVtOyI+PC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICAgIDwvZGl2PgogICAgICA8ZGl2IGNsYXNzPSJtb2RhbC1mb290ZXIiPgogICAgICAgIDxzcGFuIHN0eWxlPSJmb250LXNpemU6MC45cmVtOyBtYXJnaW4tcmlnaHQ6MTBweDsgb3BhY2l0eTowLjg7Ij5Ew6tzaGlyb25pIHRhIHTDq3JoaXFuaT88L3NwYW4+CiAgICAgICAgPGJ1dHRvbiBpZD0iYnItc3VibWl0IiBjbGFzcz0ibG9naW4tYnRuLW1vZGFsIiB0eXBlPSJidXR0b24iPjxpIGNsYXNzPSJmYXMgZmEtcGFwZXItcGxhbmUiPjwvaT4gRMOrcmdvIEvDq3JrZXPDq248L2J1dHRvbj4KICAgICAgPC9kaXY+CiAgICA8L2Rpdj4KICA8L2Rpdj4KCiAgPGRpdiBjbGFzcz0iY29udGFpbmVyIj4KICAgIDxoZWFkZXI+CiAgICAgIDxoMT5LYXRhbG9ndSBpIEJpYmxpb3Rla8OrczwvaDE+CiAgICAgIDxkaXYgY2xhc3M9ImdyZWV0aW5nLWJveCI+PHNwYW4gaWQ9ImRhdGV0aW1lIj48L3NwYW4+PC9kaXY+CiAgICAgIDxkaXYgY2xhc3M9InN0YXRzLWJhciI+CiAgICAgICAgPHNwYW4+PGkgY2xhc3M9ImZhcyBmYS1ib29rIj48L2k+IDxzcGFuIGlkPSJ0b3RhbC1ib29rcy1jb3VudCI+MDwvc3Bhbj4gTGlicmE8L3NwYW4+CiAgICAgICAgPHNwYW4+PGkgY2xhc3M9ImZhcyBmYS1leWUiPjwvaT4gTW9kYWxpdGV0aSBWaXppdG9yPC9zcGFuPgogICAgICA8L2Rpdj4KICAgIDwvaGVhZGVyPgoKICAgIDxkaXYgY2xhc3M9ImNvbnRyb2xzIj4KICAgICAgPGlucHV0IHR5cGU9InRleHQiIGlkPSJzZWFyY2gtaW5wdXQiIHBsYWNlaG9sZGVyPSJLw6tya28gdGl0dWxsaW4sIGF1dG9yaW4uLi4iIG9uaW5wdXQ9InJlc2V0UGFnZSgpIj4KICAgICAgPHNlbGVjdCBpZD0ic29ydC1vcHRpb24iIG9uY2hhbmdlPSJyZXNldFBhZ2UoKSI+CiAgICAgICAgPG9wdGlvbiB2YWx1ZT0idGl0bGUtYXNjIj5UaXR1bGxpIChBLVopPC9vcHRpb24+CiAgICAgICAgPG9wdGlvbiB2YWx1ZT0idGl0bGUtZGVzYyI+VGl0dWxsaSAoWi1BKTwvb3B0aW9uPgogICAgICAgIDxvcHRpb24gdmFsdWU9ImF1dGhvci1hc2MiPkF1dG9yaSAoQS1aKTwvb3B0aW9uPgogICAgICA8L3NlbGVjdD4KICAgICAgPHNlbGVjdCBpZD0iZ3JhZGUtZmlsdGVyIiBvbmNoYW5nZT0icmVzZXRQYWdlKCkiPgogICAgICAgIDxvcHRpb24gdmFsdWU9ImFsbCI+VMOrIGdqaXRoYSBrbGFzYXQ8L29wdGlvbj4KICAgICAgICA8b3B0aW9uIHZhbHVlPSIxIj5LbGFzYSAxPC9vcHRpb24+CiAgICAgICAgPG9wdGlvbiB2YWx1ZT0iMiI+S2xhc2EgMjwvb3B0aW9uPgogICAgICAgIDxvcHRpb24gdmFsdWU9IjMiPktsYXNhIDM8L29wdGlvbj4KICAgICAgICA8b3B0aW9uIHZhbHVlPSI0Ij5LbGFzYSA0PC9vcHRpb24+CiAgICAgICAgPG9wdGlvbiB2YWx1ZT0iNSI+S2xhc2EgNTwvb3B0aW9uPgogICAgICAgIDxvcHRpb24gdmFsdWU9IjYiPktsYXNhIDY8L29wdGlvbj4KICAgICAgICA8b3B0aW9uIHZhbHVlPSI3Ij5LbGFzYSA3PC9vcHRpb24+CiAgICAgICAgPG9wdGlvbiB2YWx1ZT0iOCI+S2xhc2EgODwvb3B0aW9uPgogICAgICAgIDxvcHRpb24gdmFsdWU9IjkiPktsYXNhIDk8L29wdGlvbj4KICAgICAgPC9zZWxlY3Q+CiAgICA8L2Rpdj4KCiAgICA8ZGl2IGlkPSJsb2FkaW5nIiBzdHlsZT0idGV4dC1hbGlnbjpjZW50ZXI7IGZvbnQtc2l6ZToxLjJlbTsgY29sb3I6IHZhcigtLWFjY2VudCk7Ij48aSBjbGFzcz0iZmFzIGZhLXNwaW5uZXIgZmEtc3BpbiI+PC9pPiBEdWtlIG5nYXJrdWFyIGxpYnJhdC4uLjwvZGl2PgogICAgPGRpdiBjbGFzcz0iYm9vay1saXN0IiBpZD0iYm9vay1saXN0Ij48L2Rpdj4KICAgIDxkaXYgY2xhc3M9InBhZ2luYXRpb24iIGlkPSJwYWdpbmF0aW9uIj48L2Rpdj4KICAgIDxkaXYgaWQ9Im5vLWJvb2tzIiBzdHlsZT0iZGlzcGxheTogbm9uZTsgdGV4dC1hbGlnbjogY2VudGVyOyBmb250LXNpemU6IDEuMmVtOyBtYXJnaW4tdG9wOiA0MHB4OyI+TnVrIHUgZ2pldCBhc25qw6sgbGliw6tyIG1lIGvDq3RvIGtyaXRlcmUuPC9kaXY+CiAgPC9kaXY+CgogIDxidXR0b24gaWQ9InNjcm9sbFRvcEJ0biIgb25jbGljaz0ic2Nyb2xsVG9Ub3AoKSI+PGkgY2xhc3M9ImZhcyBmYS1hcnJvdy11cCI+PC9pPjwvYnV0dG9uPgoKICA8c2NyaXB0IHR5cGU9Im1vZHVsZSI+CiAgICBpbXBvcnQgeyBpbml0aWFsaXplQXBwIH0gZnJvbSAiZmlyZWJhc2UvYXBwIjsKICAgIGltcG9ydCB7IGdldERhdGFiYXNlLCByZWYsIGdldCwgcHVzaCwgc2V0IH0gZnJvbSAiZmlyZWJhc2UvZGF0YWJhc2UiOwoKICAgIGlmIChsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgndGhlbWUnKSA9PT0gJ2RhcmsnKSB7CiAgICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LmFkZCgnZGFyaycpOwogICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjZGFya1RvZ2dsZSBpJykuY2xhc3NMaXN0LnJlcGxhY2UoJ2ZhLW1vb24nLCAnZmEtc3VuJyk7CiAgICB9CgogICAgY29uc3QgZmlyZWJhc2VDb25maWcgPSB7CiAgICAgIGFwaUtleTogIkFJemFTeUJPNUlWc1luSW85LUhCM3gtYUZZV28wMG5RSGVUSmwtQSIsCiAgICAgIGF1dGhEb21haW46ICJsaWJyYXJ5LXN5c3RlbS0xOGQ2OS5maXJlYmFzZWFwcC5jb20iLAogICAgICBkYXRhYmFzZVVSTDogImh0dHBzOi8vbGlicmFyeS1zeXN0ZW0tMThkNjktZGVmYXVsdC1ydGRiLmV1cm9wZS13ZXN0MS5maXJlYmFzZWRhdGFiYXNlLmFwcCIsCiAgICAgIHByb2plY3RJZDogImxpYnJhcnktc3lzdGVtLTE4ZDY5IiwKICAgICAgc3RvcmFnZUJ1Y2tldDogImxpYnJhcnktc3lzdGVtLTE4ZDY5LmFwcHNwb3QuY29tIiwKICAgICAgbWVzc2FnaW5nU2VuZGVySWQ6ICI4ODgyNjMzNzE4NjYiLAogICAgICBhcHBJZDogIjE6ODg4MjYzMzcxODY2OndlYjo2N2U1OWRjMDMxMzFkM2JjZmE3YzYzIgogICAgfTsKCiAgICBjb25zdCBhcHAgPSBpbml0aWFsaXplQXBwKGZpcmViYXNlQ29uZmlnKTsKICAgIGNvbnN0IGRiID0gZ2V0RGF0YWJhc2UoYXBwKTsKCiAgICBsZXQgYm9va3MgPSBbXTsKICAgIGxldCBjdXJyZW50UGFnZSA9IDE7CiAgICBjb25zdCBJVEVNU19QRVJfUEFHRSA9IDEyOwogICAgbGV0IHNlbGVjdGVkQm9vayA9IG51bGw7CgogICAgZnVuY3Rpb24gY2FsY0F2Z1JhdGluZyhyYXRpbmdzKSB7CiAgICAgIGlmICghcmF0aW5ncykgcmV0dXJuIDA7CiAgICAgIGNvbnN0IHZhbHMgPSBPYmplY3QudmFsdWVzKHJhdGluZ3MpOwogICAgICBjb25zdCBudW1zID0gdmFscwogICAgICAgIC5tYXAodiA9PiAodHlwZW9mIHYgPT09ICdudW1iZXInKSA/IHYgOiBOdW1iZXIodiAmJiB2LnJhdGluZyA/IHYucmF0aW5nIDogMCkpCiAgICAgICAgLmZpbHRlcihuID0+IG4gPiAwKTsKICAgICAgaWYgKG51bXMubGVuZ3RoID09PSAwKSByZXR1cm4gMDsKICAgICAgcmV0dXJuIG51bXMucmVkdWNlKChhLCBiKSA9PiBhICsgYiwgMCkgLyBudW1zLmxlbmd0aDsKICAgIH0KCiAgICBmdW5jdGlvbiB1cGRhdGVEYXRlVGltZSgpIHsKICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTsKICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RhdGV0aW1lJykudGV4dENvbnRlbnQgPSBuZXcgSW50bC5EYXRlVGltZUZvcm1hdCgnc3EtQUwnLCB7IHdlZWtkYXk6ICdsb25nJywgZGF5OiAnbnVtZXJpYycsIG1vbnRoOiAnbG9uZycsIHllYXI6ICdudW1lcmljJyB9KS5mb3JtYXQobm93KTsKICAgIH0KCiAgICBhc3luYyBmdW5jdGlvbiBmZXRjaEJvb2tzKCkgewogICAgICBjb25zdCBsb2FkZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZGluZycpOwogICAgICB0cnkgewogICAgICAgIGNvbnN0IHNuYXBzaG90ID0gYXdhaXQgZ2V0KHJlZihkYiwgJ2Jvb2tzJykpOwogICAgICAgIGlmIChzbmFwc2hvdC5leGlzdHMoKSkgewogICAgICAgICAgY29uc3QgZGF0YSA9IHNuYXBzaG90LnZhbCgpOwogICAgICAgICAgYm9va3MgPSBPYmplY3QuZW50cmllcyhkYXRhKS5tYXAoKFtrZXksIHZhbF0pID0+ICh7IC4uLnZhbCwgaWQ6IGtleSB9KSk7CiAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG90YWwtYm9va3MtY291bnQnKS5pbm5lclRleHQgPSBib29rcy5sZW5ndGg7CiAgICAgICAgICByZW5kZXJCb29rcygpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbm8tYm9va3MnKS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBsb2FkZXIuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgfQogICAgfQoKICAgIHdpbmRvdy5yZXNldFBhZ2UgPSAoKSA9PiB7IGN1cnJlbnRQYWdlID0gMTsgcmVuZGVyQm9va3MoKTsgfTsKCiAgICBmdW5jdGlvbiByZW5kZXJCb29rcygpIHsKICAgICAgY29uc3Qgc2VhcmNoVGVybSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZWFyY2gtaW5wdXQnKS52YWx1ZS50b0xvd2VyQ2FzZSgpOwogICAgICBjb25zdCBzb3J0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NvcnQtb3B0aW9uJykudmFsdWU7CiAgICAgIGNvbnN0IGdyYWRlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dyYWRlLWZpbHRlcicpLnZhbHVlOwoKICAgICAgbGV0IGZpbHRlcmVkID0gYm9va3MuZmlsdGVyKGIgPT4gewogICAgICAgIGNvbnN0IG1TID0gKGIudGl0bGU/LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoc2VhcmNoVGVybSkgfHwgYi5hdXRob3I/LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoc2VhcmNoVGVybSkpOwogICAgICAgIGNvbnN0IG1HID0gZ3JhZGUgPT09ICdhbGwnIHx8IGIucmVjb21tZW5kZWQgPT0gZ3JhZGU7CiAgICAgICAgcmV0dXJuIG1TICYmIG1HOwogICAgICB9KTsKCiAgICAgIGlmIChzb3J0ID09PSAndGl0bGUtYXNjJykgZmlsdGVyZWQuc29ydCgoYSwgYikgPT4gKGEudGl0bGUgfHwgJycpLmxvY2FsZUNvbXBhcmUoYi50aXRsZSB8fCAnJykpOwogICAgICBpZiAoc29ydCA9PT0gJ3RpdGxlLWRlc2MnKSBmaWx0ZXJlZC5zb3J0KChhLCBiKSA9PiAoYi50aXRsZSB8fCAnJykubG9jYWxlQ29tcGFyZShhLnRpdGxlIHx8ICcnKSk7CiAgICAgIGlmIChzb3J0ID09PSAnYXV0aG9yLWFzYycpIGZpbHRlcmVkLnNvcnQoKGEsIGIpID0+IChhLmF1dGhvciB8fCAnJykubG9jYWxlQ29tcGFyZShiLmF1dGhvciB8fCAnJykpOwoKICAgICAgY29uc3QgdG90YWxQYWdlcyA9IE1hdGguY2VpbChmaWx0ZXJlZC5sZW5ndGggLyBJVEVNU19QRVJfUEFHRSk7CiAgICAgIGNvbnN0IHN0YXJ0ID0gKGN1cnJlbnRQYWdlIC0gMSkgKiBJVEVNU19QRVJfUEFHRTsKICAgICAgY29uc3QgcGFnZWREYXRhID0gZmlsdGVyZWQuc2xpY2Uoc3RhcnQsIHN0YXJ0ICsgSVRFTVNfUEVSX1BBR0UpOwoKICAgICAgY29uc3QgbGlzdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdib29rLWxpc3QnKTsKICAgICAgbGlzdC5pbm5lckhUTUwgPSAnJzsKCiAgICAgIGlmIChmaWx0ZXJlZC5sZW5ndGggPT09IDApIHsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbm8tYm9va3MnKS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFnaW5hdGlvbicpLmlubmVySFRNTCA9ICcnOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbm8tYm9va3MnKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwoKICAgICAgcGFnZWREYXRhLmZvckVhY2goYm9vayA9PiB7CiAgICAgICAgY29uc3QgcXR5ID0gcGFyc2VJbnQoYm9vay5xdWFudGl0eSkgfHwgMDsKICAgICAgICBjb25zdCBhdmcgPSBjYWxjQXZnUmF0aW5nKGJvb2sucmF0aW5ncyk7CgogICAgICAgIGNvbnN0IGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgIGRpdi5jbGFzc05hbWUgPSAnYm9vayc7CiAgICAgICAgY29uc3QgaHVlID0gKChib29rLnRpdGxlIHx8ICcnKS5sZW5ndGggKiAyMCkgJSAzNjA7CiAgICAgICAgY29uc3QgY292ZXJTdHlsZSA9IGBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoMTM1ZGVnLCBoc2woJHtodWV9LCA0MCUsIDQwJSkgMCUsIGhzbCgke2h1ZX0sIDYwJSwgMjAlKSAxMDAlKTtgOwoKICAgICAgICBkaXYuaW5uZXJIVE1MID0gYAogICAgICAgICAgPGRpdiBjbGFzcz0iYm9vay1pbm5lciI+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImJvb2stY292ZXIiIHN0eWxlPSIke2NvdmVyU3R5bGV9Ij4KICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLWJvb2stb3BlbiI+PC9pPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iYm9vay1kZXRhaWxzIj4KICAgICAgICAgICAgICA8aDM+JHtlc2NhcGVIdG1sKGJvb2sudGl0bGUgfHwgIlBhIFRpdHVsbCIpfTwvaDM+CiAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iYm9vay1tZXRhIj4ke2VzY2FwZUh0bWwoYm9vay5hdXRob3IgfHwgJ0Fub25pbScpfTwvZGl2PgogICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImJvb2stbWV0YSI+JHthdmcgPiAwID8gJ+KYhSAnICsgYXZnLnRvRml4ZWQoMSkgOiAnUGEgdmxlcsOrc2ltZSd9PC9kaXY+CiAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InN0YXR1cy1iYWRnZSAke3F0eSA+IDAgPyAnYXZhaWxhYmxlJyA6ICd1bmF2YWlsYWJsZSd9Ij4ke3F0eSA+IDAgPyAnSSBEaXNwb251ZXNow6ttJyA6ICdJIFrDq27Dqyd9PC9zcGFuPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgIDwvZGl2PgogICAgICAgIGA7CiAgICAgICAgZGl2Lm9uY2xpY2sgPSAoKSA9PiBvcGVuTW9kYWwoYm9vaywgYXZnKTsKICAgICAgICBsaXN0LmFwcGVuZENoaWxkKGRpdik7CiAgICAgIH0pOwoKICAgICAgcmVuZGVyUGFnaW5hdGlvbih0b3RhbFBhZ2VzKTsKICAgIH0KCiAgICAvLyBNb2RhbCBMb2dpYwogICAgd2luZG93Lm9wZW5Nb2RhbCA9IChib29rLCBhdmdSYXRpbmcpID0+IHsKICAgICAgc2VsZWN0ZWRCb29rID0gYm9vazsKICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21vZGFsLXRpdGxlJykudGV4dENvbnRlbnQgPSBib29rLnRpdGxlIHx8ICdQYSB0aXR1bGwnOwogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbW9kYWwtYXV0aG9yJykudGV4dENvbnRlbnQgPSBib29rLmF1dGhvciB8fCAnQW5vbmltJzsKICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21vZGFsLWdlbnJlJykudGV4dENvbnRlbnQgPSBib29rLmdlbnJlIHx8ICdUamV0w6tyJzsKICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21vZGFsLXJhdGluZycpLnRleHRDb250ZW50ID0gYXZnUmF0aW5nID4gMCA/IGF2Z1JhdGluZy50b0ZpeGVkKDEpICsgJyAvIDUnIDogJ0VuZGUgcGEgdmxlcsOrc2ltZSc7CiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb2RhbC1xdHknKS50ZXh0Q29udGVudCA9IChwYXJzZUludChib29rLnF1YW50aXR5KSB8fCAwKSA+IDAgPyBgJHtib29rLnF1YW50aXR5fSBrb3BqZSBuw6sgZGlzcG96aWNpb25gIDogJ1N0b2t1IGthIG1iYXJ1YXInOwogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbW9kYWwtZGVzYycpLnRleHRDb250ZW50ID0gYm9vay5kZXNjcmlwdGlvbiB8fCAnTnVrIGthIHDDq3JzaGtyaW0gdMOrIGRldGFqdWFyIHDDq3Iga8OrdMOrIGxpYsOrci4nOwoKICAgICAgLy8gTGlicmEgQXVkaW8gKGlubGluZSBwbGF5ZXIpCiAgICAgIGNvbnN0IGF1ZGlvRGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21vZGFsLWF1ZGlvJyk7CiAgICAgIGF1ZGlvRGl2LmlubmVySFRNTCA9ICcnOwogICAgICBpZiAoYm9vay5hdWRpb1VybCkgewogICAgICAgIGNvbnN0IHNhZmVVcmwgPSBTdHJpbmcoYm9vay5hdWRpb1VybCk7CiAgICAgICAgYXVkaW9EaXYuaW5uZXJIVE1MID0gYAogICAgICAgICAgPGgzIHN0eWxlPSJtYXJnaW46MCAwIDEwcHggMDsgZm9udC1mYW1pbHk6J1BsYXlmYWlyIERpc3BsYXknLCBzZXJpZjsgZm9udC1zaXplOjE4cHg7Ij5MaWJyYSBBdWRpbzwvaDM+CiAgICAgICAgICA8YXVkaW8gY29udHJvbHMgc3R5bGU9IndpZHRoOjEwMCU7Ij4KICAgICAgICAgICAgPHNvdXJjZSBzcmM9IiR7c2FmZVVybH0iIHR5cGU9ImF1ZGlvL21wZWciPgogICAgICAgICAgICA8c291cmNlIHNyYz0iJHtzYWZlVXJsfSIgdHlwZT0iYXVkaW8vb2dnIj4KICAgICAgICAgICAgU2hmbGV0dWVzaSBqdWFqIG51ayBlIG1iw6tzaHRldCBhdWRpb24uCiAgICAgICAgICA8L2F1ZGlvPgogICAgICAgIGA7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYXVkaW9EaXYuaW5uZXJIVE1MID0gJzxwIHN0eWxlPSJvcGFjaXR5OjAuODU7IG1hcmdpbjowOyI+TnVrIGthIExpYnJhIEF1ZGlvIHDDq3Iga8OrdMOrIGxpYsOrci48L3A+JzsKICAgICAgfQoKICAgICAgLy8gUmVzZXQgcmVxdWVzdCBmb3JtCiAgICAgIGNvbnN0IGJyTXNnID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JyLW1zZycpOwogICAgICBick1zZy50ZXh0Q29udGVudCA9ICcnOwogICAgICBick1zZy5zdHlsZS5jb2xvciA9ICcnOwogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnItbmFtZScpLnZhbHVlID0gJyc7CiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdici1lbWFpbCcpLnZhbHVlID0gJyc7CiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdici1jbGFzcycpLnZhbHVlID0gJyc7CgogICAgICAvLyBSZXNldCByYXRpbmcgZm9ybQogICAgICBjb25zdCByYXRlTXNnID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JhdGUtbXNnJyk7CiAgICAgIGlmIChyYXRlTXNnKSB7IHJhdGVNc2cudGV4dENvbnRlbnQgPSAnJzsgcmF0ZU1zZy5zdHlsZS5jb2xvciA9ICcnOyB9CiAgICAgIGNvbnN0IHJzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JhdGUtc3RhcnMnKTsKICAgICAgaWYgKHJzKSBycy52YWx1ZSA9ICc1JzsKICAgICAgY29uc3Qgcm4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmF0ZS1uYW1lJyk7CiAgICAgIGlmIChybikgcm4udmFsdWUgPSAnJzsKICAgICAgY29uc3QgcmMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmF0ZS1jb21tZW50Jyk7CiAgICAgIGlmIChyYykgcmMudmFsdWUgPSAnJzsKCiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdib29rTW9kYWwnKS5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOwogICAgfTsKCiAgICAvLyBTZW5kIGJvcnJvdyByZXF1ZXN0IChndWVzdCkKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdici1zdWJtaXQnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGFzeW5jICgpID0+IHsKICAgICAgY29uc3QgbXNnID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JyLW1zZycpOwogICAgICBjb25zdCBuYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JyLW5hbWUnKS52YWx1ZS50cmltKCk7CiAgICAgIGNvbnN0IGVtYWlsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JyLWVtYWlsJykudmFsdWUudHJpbSgpOwogICAgICBjb25zdCBrbGFzcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdici1jbGFzcycpLnZhbHVlLnRyaW0oKTsKCiAgICAgIGlmICghc2VsZWN0ZWRCb29rIHx8ICFzZWxlY3RlZEJvb2suaWQpIHsKICAgICAgICBtc2cuc3R5bGUuY29sb3IgPSAnY3JpbXNvbic7CiAgICAgICAgbXNnLnRleHRDb250ZW50ID0gJ0dhYmltOiBMaWJyaSBudWsgdSBnamV0Lic7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmICghbmFtZSB8fCAhZW1haWwgfHwgIWtsYXNzKSB7CiAgICAgICAgbXNnLnN0eWxlLmNvbG9yID0gJ2NyaW1zb24nOwogICAgICAgIG1zZy50ZXh0Q29udGVudCA9ICdKdSBsdXRlbSBwbG90w6tzb25pIEVtcmluLCBFbWFpbCBkaGUgS2xhc8Orbi4nOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3QgYnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JyLXN1Ym1pdCcpOwogICAgICBidG4uZGlzYWJsZWQgPSB0cnVlOwogICAgICBidG4uc3R5bGUub3BhY2l0eSA9ICcwLjcnOwogICAgICBtc2cudGV4dENvbnRlbnQgPSAnRHVrZSBkw6tyZ3Vhci4uLic7CiAgICAgIG1zZy5zdHlsZS5jb2xvciA9ICcnOwoKICAgICAgdHJ5IHsKICAgICAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpOwogICAgICAgIGNvbnN0IGRhdGUgPSBuZXcgSW50bC5EYXRlVGltZUZvcm1hdCgnc3EtQUwnLCB7IGRheTogJzItZGlnaXQnLCBtb250aDogJzItZGlnaXQnLCB5ZWFyOiAnbnVtZXJpYycgfSkuZm9ybWF0KG5vdyk7CgogICAgICAgIC8vIEZvcm1hdCB0aW1lIGFzIDEyLWhvdXIgd2l0aCBBbGJhbmlhbiBzdWZmaXgKICAgICAgICAvLyAibS5kIGUgcGFyYWRpdGVzIiBmb3IgQU0sICJtLmQgZSBwYXNkaXRlcyIgZm9yIFBNCiAgICAgICAgY29uc3QgaGgyNCA9IG5vdy5nZXRIb3VycygpOwogICAgICAgIGNvbnN0IG1tID0gU3RyaW5nKG5vdy5nZXRNaW51dGVzKCkpLnBhZFN0YXJ0KDIsICcwJyk7CiAgICAgICAgY29uc3QgaGgxMiA9ICgoaGgyNCAlIDEyKSB8fCAxMik7CiAgICAgICAgY29uc3Qgc3VmZml4ID0gKGhoMjQgPj0gMTIpID8gJ20uZCBlIHBhc2RpdGVzJyA6ICdtLmQgZSBwYXJhZGl0ZXMnOwogICAgICAgIGNvbnN0IHRpbWUgPSBgJHtTdHJpbmcoaGgxMikucGFkU3RhcnQoMiwnMCcpfToke21tfSAke3N1ZmZpeH1gOwoKICAgICAgICBjb25zdCByZXFSZWYgPSBwdXNoKHJlZihkYiwgJ2JvcnJvd19yZXF1ZXN0cycpKTsKICAgICAgICBhd2FpdCBzZXQocmVxUmVmLCB7CiAgICAgICAgICBib3Jyb3dlck5hbWU6IG5hbWUsCiAgICAgICAgICBib3Jyb3dlckVtYWlsOiBlbWFpbCwKICAgICAgICAgIGJvcnJvd2VyQ2xhc3M6IGtsYXNzLAogICAgICAgICAgYm9va0lkOiBzZWxlY3RlZEJvb2suaWQsCiAgICAgICAgICBib29rVGl0bGU6IHNlbGVjdGVkQm9vay50aXRsZSB8fCAnJywKICAgICAgICAgIHN0YXR1czogJ1BlbmRpbmcnLAogICAgICAgICAgZGF0ZSwKICAgICAgICAgIHRpbWUsCiAgICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCkKICAgICAgICB9KTsKICAgICAgICBtc2cuc3R5bGUuY29sb3IgPSAnZ3JlZW4nOwogICAgICAgIG1zZy50ZXh0Q29udGVudCA9ICdLw6tya2VzYSB1IGTDq3JndWEgbWUgc3Vrc2VzISc7CiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTsKICAgICAgICBtc2cuc3R5bGUuY29sb3IgPSAnY3JpbXNvbic7CiAgICAgICAgbXNnLnRleHRDb250ZW50ID0gJ0dhYmltOiBudWsgdSBhcnJpdCBkw6tyZ2ltaSBpIGvDq3JrZXPDq3MuJzsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBidG4uZGlzYWJsZWQgPSBmYWxzZTsKICAgICAgICBidG4uc3R5bGUub3BhY2l0eSA9ICcnOwogICAgICB9CiAgICB9KTsKCiAgICAvLyBTZW5kIHJhdGluZyAoZ3Vlc3QpCiAgICBjb25zdCByYXRlQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JhdGUtc3VibWl0Jyk7CiAgICBpZiAocmF0ZUJ0bikgewogICAgICByYXRlQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKCkgPT4gewogICAgICAgIGNvbnN0IG1zZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyYXRlLW1zZycpOwogICAgICAgIGNvbnN0IHN0YXJzID0gcGFyc2VJbnQoKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyYXRlLXN0YXJzJykgfHwge30pLnZhbHVlIHx8ICcwJywgMTApOwogICAgICAgIGNvbnN0IG5hbWUgPSAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JhdGUtbmFtZScpIHx8IHt9KS52YWx1ZSA/IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyYXRlLW5hbWUnKS52YWx1ZS50cmltKCkgOiAnJzsKICAgICAgICBjb25zdCBjb21tZW50ID0gKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyYXRlLWNvbW1lbnQnKSB8fCB7fSkudmFsdWUgPyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmF0ZS1jb21tZW50JykudmFsdWUudHJpbSgpIDogJyc7CgogICAgICAgIGlmICghc2VsZWN0ZWRCb29rIHx8ICFzZWxlY3RlZEJvb2suaWQpIHsKICAgICAgICAgIGlmIChtc2cpIHsgbXNnLnN0eWxlLmNvbG9yID0gJ2NyaW1zb24nOyBtc2cudGV4dENvbnRlbnQgPSAnR2FiaW06IExpYnJpIG51ayB1IGdqZXQuJzsgfQogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAoIXN0YXJzIHx8IHN0YXJzIDwgMSB8fCBzdGFycyA+IDUpIHsKICAgICAgICAgIGlmIChtc2cpIHsgbXNnLnN0eWxlLmNvbG9yID0gJ2NyaW1zb24nOyBtc2cudGV4dENvbnRlbnQgPSAnSnUgbHV0ZW0gemdqaWRobmkgdmxlcsOrc2ltaW4gKDEtNSkuJzsgfQogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgcmF0ZUJ0bi5kaXNhYmxlZCA9IHRydWU7CiAgICAgICAgcmF0ZUJ0bi5zdHlsZS5vcGFjaXR5ID0gJzAuNyc7CiAgICAgICAgaWYgKG1zZykgeyBtc2cuc3R5bGUuY29sb3IgPSAnJzsgbXNnLnRleHRDb250ZW50ID0gJ0R1a2UgZMOrcmd1YXIgdmxlcsOrc2ltaW4uLi4nOyB9CgogICAgICAgIHRyeSB7CiAgICAgICAgICBjb25zdCByUmVmID0gcHVzaChyZWYoZGIsIGBib29rcy8ke3NlbGVjdGVkQm9vay5pZH0vcmF0aW5nc2ApKTsKICAgICAgICAgIGF3YWl0IHNldChyUmVmLCB7CiAgICAgICAgICAgIHJhdGluZzogc3RhcnMsCiAgICAgICAgICAgIG5hbWU6IG5hbWUgfHwgbnVsbCwKICAgICAgICAgICAgY29tbWVudDogY29tbWVudCB8fCBudWxsLAogICAgICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCkKICAgICAgICAgIH0pOwoKICAgICAgICAgIC8vIFVwZGF0ZSBVSQogICAgICAgICAgc2VsZWN0ZWRCb29rLnJhdGluZ3MgPSBzZWxlY3RlZEJvb2sucmF0aW5ncyB8fCB7fTsKICAgICAgICAgIHNlbGVjdGVkQm9vay5yYXRpbmdzW3JSZWYua2V5XSA9IHsgcmF0aW5nOiBzdGFycyB9OwoKICAgICAgICAgIGNvbnN0IGF2Z05vdyA9IGNhbGNBdmdSYXRpbmcoc2VsZWN0ZWRCb29rLnJhdGluZ3MpOwogICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21vZGFsLXJhdGluZycpLnRleHRDb250ZW50ID0gYXZnTm93ID4gMCA/IGF2Z05vdy50b0ZpeGVkKDEpICsgJyAvIDUnIDogJ0VuZGUgcGEgdmxlcsOrc2ltZSc7CgogICAgICAgICAgY29uc3QgaWR4ID0gYm9va3MuZmluZEluZGV4KGIgPT4gYi5pZCA9PT0gc2VsZWN0ZWRCb29rLmlkKTsKICAgICAgICAgIGlmIChpZHggPj0gMCkgewogICAgICAgICAgICBib29rc1tpZHhdLnJhdGluZ3MgPSB7IC4uLihib29rc1tpZHhdLnJhdGluZ3MgfHwge30pLCBbclJlZi5rZXldOiB7IHJhdGluZzogc3RhcnMgfSB9OwogICAgICAgICAgICByZW5kZXJCb29rcygpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChtc2cpIHsgbXNnLnN0eWxlLmNvbG9yID0gJ2dyZWVuJzsgbXNnLnRleHRDb250ZW50ID0gJ0ZhbGVtaW5kZXJpdCEgVmxlcsOrc2ltaSB1IHJ1YWp0Lic7IH0KICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTsKICAgICAgICAgIGlmIChtc2cpIHsgbXNnLnN0eWxlLmNvbG9yID0gJ2NyaW1zb24nOyBtc2cudGV4dENvbnRlbnQgPSAnR2FiaW06IG51ayB1IGFycml0IHJ1YWp0amEgZSB2bGVyw6tzaW1pdC4nOyB9CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgIHJhdGVCdG4uZGlzYWJsZWQgPSBmYWxzZTsKICAgICAgICAgIHJhdGVCdG4uc3R5bGUub3BhY2l0eSA9ICcnOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CgogICAgd2luZG93LmNsb3NlTW9kYWwgPSAoZSkgPT4gewogICAgICBpZiAoZS50YXJnZXQuaWQgPT09ICdib29rTW9kYWwnKSB7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Jvb2tNb2RhbCcpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgIH0KICAgIH07CgogICAgZnVuY3Rpb24gcmVuZGVyUGFnaW5hdGlvbih0b3RhbCkgewogICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFnaW5hdGlvbicpOwogICAgICBjb250YWluZXIuaW5uZXJIVE1MID0gJyc7CiAgICAgIGlmICh0b3RhbCA8PSAxKSByZXR1cm47CiAgICAgIGZvciAobGV0IGkgPSAxOyBpIDw9IHRvdGFsOyBpKyspIHsKICAgICAgICBjb25zdCBidG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTsKICAgICAgICBidG4uY2xhc3NOYW1lID0gYHBhZ2UtYnRuICR7aSA9PT0gY3VycmVudFBhZ2UgPyAnYWN0aXZlJyA6ICcnfWA7CiAgICAgICAgYnRuLmlubmVyVGV4dCA9IGk7CiAgICAgICAgYnRuLm9uY2xpY2sgPSAoKSA9PiB7IGN1cnJlbnRQYWdlID0gaTsgcmVuZGVyQm9va3MoKTsgfTsKICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoYnRuKTsKICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGVzY2FwZUh0bWwodGV4dCkgewogICAgICByZXR1cm4gdGV4dCA/IFN0cmluZyh0ZXh0KS5yZXBsYWNlKC8mL2csICImYW1wOyIpLnJlcGxhY2UoLzwvZywgIiZsdDsiKS5yZXBsYWNlKC8+L2csICImZ3Q7IikgOiAnJzsKICAgIH0KCiAgICB3aW5kb3cudG9nZ2xlRGFya01vZGUgPSAoKSA9PiB7CiAgICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LnRvZ2dsZSgnZGFyaycpOwogICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgndGhlbWUnLCBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5jb250YWlucygnZGFyaycpID8gJ2RhcmsnIDogJ2xpZ2h0Jyk7CiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNkYXJrVG9nZ2xlIGknKS5jbGFzc0xpc3QucmVwbGFjZSgKICAgICAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5jb250YWlucygnZGFyaycpID8gJ2ZhLW1vb24nIDogJ2ZhLXN1bicsCiAgICAgICAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QuY29udGFpbnMoJ2RhcmsnKSA/ICdmYS1zdW4nIDogJ2ZhLW1vb24nCiAgICAgICk7CiAgICB9OwoKICAgIHdpbmRvdy5zY3JvbGxUb1RvcCA9ICgpID0+IHsgd2luZG93LnNjcm9sbFRvKHsgdG9wOiAwLCBiZWhhdmlvcjogJ3Ntb290aCcgfSk7IH07CiAgICB3aW5kb3cub25zY3JvbGwgPSAoKSA9PiB7IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzY3JvbGxUb3BCdG4nKS5zdHlsZS5kaXNwbGF5ID0gd2luZG93LnNjcm9sbFkgPiAzMDAgPyAnYmxvY2snIDogJ25vbmUnOyB9OwoKICAgIHVwZGF0ZURhdGVUaW1lKCk7CiAgICBmZXRjaEJvb2tzKCk7CiAgPC9zY3JpcHQ+CjwvYm9keT4KPC9odG1sPgo=";

      function decodeB64(b64){
        try {
          const bin = atob(b64);
          const bytes = Uint8Array.from(bin, c => c.charCodeAt(0));
          return new TextDecoder('utf-8').decode(bytes);
        } catch(e){
          console.error('Failed to decode dashboard HTML', e);
          return '';
        }
      }

      function mountGuest(){
        if (document.getElementById('guest-iframe-wrap')) return;

        const wrap = document.createElement('div');
        wrap.className = 'guest-iframe-wrap';
        wrap.id = 'guest-iframe-wrap';

        const topbar = document.createElement('div');
        topbar.className = 'guest-topbar';

        const back = document.createElement('button');
        back.className = 'guest-back';
        back.type = 'button';
        back.innerHTML = '<i class="fas fa-arrow-left"></i> Kthehu';
        back.addEventListener('click', () => {
          location.hash = '';
          unmountGuest();
        });

        const iframe = document.createElement('iframe');
        iframe.className = 'guest-iframe';
        iframe.setAttribute('title','Modaliteti Vizitor');
        iframe.setAttribute('sandbox','allow-scripts allow-same-origin allow-forms allow-modals allow-popups');
        iframe.srcdoc = decodeB64(DASHBOARD_B64);

        topbar.appendChild(back);
        wrap.appendChild(topbar);
        wrap.appendChild(iframe);

        document.body.appendChild(wrap);
      }

      function unmountGuest(){
        const wrap = document.getElementById('guest-iframe-wrap');
        if (wrap) wrap.remove();
      }

      window.openGuest = function(e){
        if (e) e.preventDefault();
        location.hash = 'vizitor';
        mountGuest();
      };

      window.addEventListener('hashchange', () => {
        if (location.hash === '#vizitor') mountGuest();
        else unmountGuest();
      });

      if (location.hash === '#vizitor') {
        mountGuest();
      }
    })();
  </script>

</body>
</html>
